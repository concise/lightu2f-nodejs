# lightu2f-nodejs is a zero-dependency FIDO U2F relying party library

This project is still in its pre-alpha stage.

The module lightu2f.js exposes four functions, which implement the core logic
of U2F transactions at the perspective of a U2F Relying Party:

- `genRegChall` generates one registration challenge
- `procRegResp` processes one registration response
- `genAuthChall` generates one authentication challenge
- `procAuthResp` processes one authentication response

Below are two diagrams that show how you can use these functions to do your U2F
transactions.



                  A U2F Registration Transaction

        U2F Client                          U2F Relying Party
             |                                      |
             |               regChall               |
             |<-------------------------------------| genRegChall()
             |                                      |
             |                                      |
             |------------------------------------->| procRegResp()
             |               regResp                |
             v                                      v


                  A U2F Authentication Transaction

        U2F Client                          U2F Relying Party
             |                                      |
             |               authChall              |
             |<-------------------------------------| genAuthChall()
             |                                      |
             |                                      |
             |------------------------------------->| procAuthResp()
             |               authResp               |
             v                                      v


Arguments for genRegChall() and genAuthChall()

    appId (String)

        This is a unicode string like "https://example.com" that identifies
        yourself.  For the simplest case, this is just the web origin of your
        website.  Check U2F spec for more information on application identity
        if you need to support multiple domains at once.

    nonce (String)

        This is a websafe-base64-encoded octet string that is only used once
        for a transaction.  It must be unpredictable.  32 bytes from
        /dev/urandom should be good for example.

    keyHandles (Array of Strings)

        This is an enumerable collection that _MUST_ contain zero or more
        web-safe-base64-encoded octet strings.  Each octet string is a
        registered key handle of the user you are dealing with, and its length
        _MUST_NOT_ exceed 255.

        A key handle is used to uniquely identify a key pair generated by some
        U2F authenticator.

    tuples (Array of [kh, pk, cnt])

        This is an enumerable collection that _MUST_ contain one or more
        Arrays, each of which contains three values: values: (1) a key handle,
        (2) a public key, and (3) a counter.

            (1) the key handle _MUST_ be an octet string of length 0-255.
            (2) the public key _MUST_ be an octet string of length 65.
            (3) the counter _MUST_ be an integer in range [0, 2**32-1] or null.

        The key handle and the public key is websafe-base64-encoded.  The
        counter is represented using Number and Null types directly.

        A (kh, pk, cnt) tuple describes all necessary information about a U2F
        authenticator registered by a user.


### Some URLs:

- https://fidoalliance.org/specs/fido-u2f-v1.0-ps-20141009/fido-u2f-javascript-api-ps-20141009.html
- https://fidoalliance.org/specs/fido-u2f-v1.0-ps-20141009/fido-u2f-raw-message-formats-ps-20141009.html
- https://github.com/google/u2f-ref-code/raw/master/u2f-gae-demo/war/js/u2f-api.js
- https://developers.yubico.com/U2F/Libraries/Using_a_library.html
